// Generated by CoffeeScript 1.4.0
(function() {
  var Hashmap, SymbolTable, TR, esnode, util;

  util = require('./util');

  Hashmap = require('./hashmap');

  esnode = require('./esnode');

  TR = require('./trace');

  SymbolTable = (function() {

    function SymbolTable(prev) {
      this.prev = prev != null ? prev : null;
      this.dupes = {};
      this.inner = new Hashmap({
        hashCode: util.hashCode
      });
    }

    SymbolTable.prototype.has = function(key) {
      if (this.inner.has(key)) {
        return true;
      } else if (this.prev) {
        return this.prev.has(key);
      } else {
        return false;
      }
    };

    SymbolTable.prototype.get = function(key) {
      if (this.inner.has(key)) {
        return this.inner.get(key);
      } else if (this.prev) {
        return this.prev.get(key);
      } else {
        throw new Error("escompile:unknown_identifier: " + key);
      }
    };

    SymbolTable.prototype.alias = function(key) {
      var newKey;
      if (this.has(key)) {
        return this.get(key);
      } else {
        newKey = this.newKey(key);
        this.inner.set(key, newKey);
        return newKey;
      }
    };

    SymbolTable.prototype.newKey = function(key) {
      var name;
      name = key.value;
      if (!this.dupes.hasOwnProperty(name)) {
        this.dupes[name] = 0;
      } else {
        this.dupes[name]++;
      }
      if (this.dupes[name] === 0) {
        return esnode.identifier(name);
      } else {
        return esnode.identifier(name + "$" + this.dupes[name]);
      }
    };

    return SymbolTable;

  })();

  module.exports = SymbolTable;

}).call(this);
